{% extends 'admin/master.html' %}
{% block title %}Contribute{% endblock %}
{% block head %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js" xmlns="http://www.w3.org/1999/html"
        xmlns="http://www.w3.org/1999/html"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
{% endblock %}
{% block brand %}
{% endblock %}

{% block page_body %}
<nav class="navbar navbar-expand-sm bg-light navbar-light">
  <div class="container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse navbar-right" id="collapsibleNavbar">
{% block menu_links %}
        <div class="container col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
        <a href="http://127.0.0.1:5050/admin/logout">
          <button type="button" class="btn btn-lg btn-outline-info col-xs-12 col-sm-10 col-md-12 col-lg-2
        col-xl-2" style="margin: 8px;">Logout</button>
        </a>

        <a href="http://127.0.0.1:5050/admin/user" style="margin: 8px;">
          <button type="button" class="btn btn-lg btn-secondary col-xs-12 col-sm-10 col-md-12 col-lg-2
        col-xl-2" style="margin: 8px;">Users</button>
        </a>

        <a href="http://127.0.0.1:5050/admin/all_published" style="margin: 8px;">
          <button type="button" class="btn btn-lg btn-secondary col-xs-12 col-sm-10 col-md-12 col-lg-2
        col-xl-2" style="margin: 8px;">Published Papers</button>
        </a>

        <a href="http://127.0.0.1:5050/admin/paper_reviews" style="margin: 8px;">
          <button type="button" class="btn btn-lg btn-secondary col-xs-12 col-sm-10 col-md-12 col-lg-2
        col-xl-2" style="margin: 8px;">Paper Reviews</button>
        </a>
        <a href="http://127.0.0.1:5050/admin/submissions" style="margin: 8px;">
          <button type="button" class="btn btn-lg btn-secondary col-xs-12 col-sm-10 col-md-12 col-lg-2
        col-xl-2" style="margin: 8px;">Submissions</button>
        </a>
</div>
    </div>
</nav>
{% endblock %}

{% block body %}
<div class="container col-xs-12 col-sm-12 col-md-12 col-lg-6 col-xl-6" style="padding: 30px;">
    {% with messages = get_flashed_messages() %}
   {% if messages %}
     <ul class="flashes">
        {% for message in messages %}
         <div class="message_flash">{{ message }}</div>
        {% endfor %}
    </ul>
  {% endif %}
 {% endwith %}
    <h1>Contribute</h1>
    <div class="row-fluid">
    <h2>Submit A Paper</h2>
    <form method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <h4><label for="title">Title:</label></h4>
        <input class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12" type="text" id="title" name="title" required>
        <br><br>

        <h4><label for="abstract">Abstract:</label></h4>
        <textarea class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12" rows="10" cols="50"
                  style="font-size: 16px;"
                  id="abstract" name="abstract" required></textarea>
        <br><br>

        <h4><label for="authors">Authors:</label></h4>
        <input class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12" type="text" id="authors" name="authors" required>
        <br><br>

        <h4><label for="file">Paper File (PDF or IPYNB):</label></h4>
        <input class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12" type="file" id="file" name="file"
               accept=".pdf,.ipynb" required>
            <br><br>
        <button class="btn btn-primary" type="submit" value="Submit" style="width: 150px;">Submit</button>
    </form>
</div>
    </div>

{% block table %}
<div class="container col-xs-12 col-sm-12 col-md-12 col-lg-6 col-xl-6" style="padding: 30px;">
<div class="select container col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
    <br><br>
    <h2>Review A Paper</h2>
    <form method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <select class="form-control" id="paperSelect" name="paper_title">
        <option value="">Select a Paper</option>
        {% for paper in data %}
            <option name="paper" value="{{ paper.title }}">{{ paper.title }} By {{ paper.authors }}</option>
        {% endfor %}
    </select>
    <br><br>
    <input type="submit" class="btn btn-primary" id="reviewButton" name="review" value="Review" style="width: 150px;">
    </form>
    <br><br>
</div>
    </div>
<script>

document.getElementById('reviewButton').addEventListener('click', function() {
    var selectedPaperId = document.getElementById('paperSelect').value;
    if (selectedPaperId) {
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = '/admin/write_review';

        var hiddenField = document.createElement('input');
        hiddenField.type = 'hidden';
        hiddenField.name = 'paper_id';
        hiddenField.value = selectedPaperId;

        // Add CSRF Token
        var csrfField = document.createElement('input');
        csrfField.type = 'hidden';
        csrfField.name = 'csrf_token';
        csrfField.value = '{{ csrf_token }}'; // Use the token passed from Flask
        form.appendChild(csrfField);

        form.appendChild(hiddenField);
        document.body.appendChild(form);
        form.submit();
    } else {
        alert('Please select a paper to review.');
    }
});


</script>
</div>
{% endblock %}
{% endblock %}
{% endblock %}
{% block tail_js %}
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity=
        "sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity=
        "sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
{% endblock %}


