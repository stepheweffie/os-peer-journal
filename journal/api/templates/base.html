<html lang="en">

<head>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>

<body>

<p>Hello, World Views!</p>

<py-script>
    async function loadPyodideAndRun(){
        await loadPyodide({ indexURL: 'https://cdn.jsdelivr.net/pyodide/v0.18.1/full/' });
        pyodide.runPython(`
            import asyncio
            import json
            import httpx
            import sys
            print(sys.version)

            baseurl = "https://jsonplaceholder.typicode.com"
            async def request(url, method="GET", headers=None, body=None):
                async with httpx.AsyncClient() as client:
                    if method == "GET":
                        response = await client.get(url, headers=headers)
                    elif method == "POST":
                        response = await client.post(url, data=body, headers=headers)
                    elif method == "PUT":
                        response = await client.put(url, data=body, headers=headers)
                    elif method == "DELETE":
                        response = await client.delete(url, headers=headers)
                    return response
            async def main():
                # GET
                headers = {"Content-type": "application/json"}
                new_get = await request(f"{baseurl}/posts/2", method="GET", headers=headers)
                print(f"GET request=> status:{new_get.status}, json:{await new_get.json()}")

                # POST
                body = json.dumps({"title": "test_title", "body": "test body", "userId": 1})
                new_post = await request(f"{baseurl}/posts", body=body, method="POST", headers=headers)
                print(f"POST request=> status:{new_post.status}, json:{await new_post.json()}")

                # PUT
                body = json.dumps({"id": 1, "title": "test_title", "body": "test body", "userId": 2})
                updated_post = await request(f"{baseurl}/posts/1", body=body, method="PUT", headers=headers)
                print(f"PUT request=> status:{updated_post.status}, json:{await updated_post.json()}")

                # DELETE
                deleted_post = await request(f"{baseurl}/posts/1", method="DELETE", headers=headers)
                print(f"DELETE request=> status:{deleted_post.status}, json:{await deleted_post.json()}")

                asyncio.ensure_future(main())
        `);
    }

    window.onload = () => {
        loadPyodideAndRun();
    };
<py-script>
</body>
